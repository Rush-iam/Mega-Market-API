# Mega Market API

## Что это?
**Mega Market API** - бэкенд для веб-сервиса агрегатора товаров.

Сервис взаимодействует с БД **PostgreSQL**.\
Основан на модулях:
- **aiohttp** - асинхронный HTTP сервер
- **SQL Alchemy** - ORM библиотека для работы с реляционными СУБД
- **asyncpg** - асинхронный драйвер/интерфейс PostgreSQL
- **Alembic** - средство миграции СУБД
- **marshmallow** - сериализатор/валидатор json данных
- **apispec** - генерация документации и OpenAPI спецификации (`/docs`)

## Какие возможности?

#### Прочитать полную спецификацию API можно после запуска сервера, по ссылке:
### `/docs`

### Характеристики:
Имеются сущности: товар `OFFER` и категория `CATEGORY`.
- `id`: uuid идентификатор
- `name`: имя
- `parentId`: идентификатор родительской категории
- `type`: тип (`OFFER` или `CATEGORY`)
- `price`: цена товара или средняя цена товаров в категории
- `date`: время последнего обновления
- `children`: дочерние объекты категории

### Доступные методы:
### `/imports`
Импортирует новые товары и/или категории.\
Товары/категории импортированные повторно обновляют текущие.
### `/delete/{id}`
Удаляет элемент по идентификатору.\
При удалении категории удаляются все дочерние элементы.
### `/nodes/{id}`
Предоставляет информацию об элементе по идентификатору.\
При получении информации о категории также предоставляется информация о её дочерних элементах.
### `/sales?date={to}`
Получение списка товаров, цена которых была обновлена в течение 24 часов до времени, переданном в запросе.
### ~~`/node/{id}/statistic?dateStart={from}&dateEnd={to}`~~
~~Получение статистики (истории обновлений) по товару/категории за заданный полуинтервал [from, to)~~

## Как запустить?
### В контейнере
#### Требуется: Docker Compose v2+
1) Перейдите в директорию `/deploy`:

`cd deploy`

2) Запустите сборку и запуск контейнеров:

`make up`

Для последующего удаления контейнеров вместе с данными:

`make clean`

Опционально можно настроить параметры создаваемого пользователя/пароля/базы в файле `config.env` (параметр `DB_HOST` игнорируется)

### Нативно
#### Требования: PostgreSQL 14+ и Python 3.10+
1) Установите требуемые зависимости _([виртуальное окружение](https://docs.python.org/3.10/tutorial/venv.html))_:

`pip install -r requirements.txt`
2) Настройте конфигурацию подключения к **PostgreSQL** в файле `config.env`:
```
DB_HOST=localhost
DB_DATABASE=mega_market
DB_USERNAME=postgres_user
DB_PASSWORD=your_db_password
```
3) Проведите миграции для инициализации таблиц / функций / триггеров в БД:

`alembic upgrade head`

4) Запуск сервера:

`python main.py`

_(опционально: **debug** режим включается **env** переменной `DEBUG`)_

---
_Артем **nGragas/Rush_iam** Корников.\
Вступительный проект для Летней Школы Бэкенд Разработки Яндекс 2022._